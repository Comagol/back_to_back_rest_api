Schema	
Object Type	
Object Name	
Script
Script

  CREATE TABLE "POC_PRODUCT_CATEGORIES" 
   (	"CATEGORY_CODE" VARCHAR2(50) NOT NULL ENABLE, 
	"CATEGORY_NAME" VARCHAR2(200) NOT NULL ENABLE, 
	"ACTIVE_YN" CHAR(1) DEFAULT 'Y' NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6), 
	 CONSTRAINT "POC_PROD_CAT_ACTIVE_CK" CHECK (active_yn IN ('Y','N')) ENABLE, 
	 CONSTRAINT "POC_PROD_CAT_PK" PRIMARY KEY ("CATEGORY_CODE")
  USING INDEX  ENABLE
   ) ;

  CREATE TABLE "POC_STORES" 
   (	"STORE_CODE" VARCHAR2(30) NOT NULL ENABLE, 
	"STORE_NAME" VARCHAR2(200) NOT NULL ENABLE, 
	"REGION_CODE" VARCHAR2(30), 
	"ACTIVE_YN" CHAR(1) DEFAULT 'Y' NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6), 
	 CONSTRAINT "POC_STORES_ACTIVE_CK" CHECK (active_yn IN ('Y','N')) ENABLE, 
	 CONSTRAINT "POC_STORES_PK" PRIMARY KEY ("STORE_CODE")
  USING INDEX  ENABLE
   ) ;

  CREATE TABLE "POC_WEEKLY_SALES" 
   (	"SALES_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"WEEK_START" DATE NOT NULL ENABLE, 
	"STORE_CODE" VARCHAR2(30) NOT NULL ENABLE, 
	"PRODUCT_CATEGORY" VARCHAR2(50) NOT NULL ENABLE, 
	"UNITS_SOLD" NUMBER(12,0) NOT NULL ENABLE, 
	"GROSS_SALES" NUMBER(14,2) NOT NULL ENABLE, 
	"SOURCE_BATCH_ID" NUMBER NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6), 
	"CREATED_BY" VARCHAR2(255) DEFAULT COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER) NOT NULL ENABLE, 
	"UPDATED_BY" VARCHAR2(255), 
	 CONSTRAINT "POC_SALES_UNITS_CK" CHECK (units_sold >= 0) ENABLE, 
	 CONSTRAINT "POC_SALES_GROSS_CK" CHECK (gross_sales >= 0) ENABLE, 
	 PRIMARY KEY ("SALES_ID")
  USING INDEX  ENABLE, 
	 CONSTRAINT "POC_SALES_BUSINESS_UQ" UNIQUE ("WEEK_START", "STORE_CODE", "PRODUCT_CATEGORY")
  USING INDEX  ENABLE
   ) ;

  CREATE TABLE "POC_WEEKLY_SALES_BATCH" 
   (	"BATCH_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"FILE_NAME" VARCHAR2(512) NOT NULL ENABLE, 
	"MIME_TYPE" VARCHAR2(255), 
	"CONTENT_SIZE_BYTES" NUMBER, 
	"TEMPLATE_VERSION" VARCHAR2(30), 
	"UPLOADED_BY" VARCHAR2(255) NOT NULL ENABLE, 
	"UPLOADED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"VALIDATION_STARTED_AT" TIMESTAMP (6), 
	"VALIDATION_FINISHED_AT" TIMESTAMP (6), 
	"PROCESS_STARTED_AT" TIMESTAMP (6), 
	"PROCESS_FINISHED_AT" TIMESTAMP (6), 
	"STATUS" VARCHAR2(30) DEFAULT 'UPLOADED' NOT NULL ENABLE, 
	"TOTAL_ROWS_UPLOADED" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"TOTAL_ROWS_VALID" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"TOTAL_ROWS_INVALID" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"TOTAL_ROWS_INSERTED" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"TOTAL_ROWS_UPDATED" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"TOTAL_ROWS_REJECTED" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"ERROR_MESSAGE" VARCHAR2(4000), 
	 CONSTRAINT "POC_SALES_BATCH_STATUS_CK" CHECK ( 
        status IN ( 
            'UPLOADED', 
            'PARSED', 
            'VALIDATED', 
            'PROCESSED', 
            'PROCESSED_WITH_ERRORS', 
            'FAILED' 
        ) 
    ) ENABLE, 
	 PRIMARY KEY ("BATCH_ID")
  USING INDEX  ENABLE
   ) ;

  CREATE TABLE "POC_WEEKLY_SALES_STG" 
   (	"STG_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"BATCH_ID" NUMBER NOT NULL ENABLE, 
	"EXCEL_ROW_NUM" NUMBER NOT NULL ENABLE, 
	"RAW_WEEK_START" VARCHAR2(100), 
	"RAW_STORE_CODE" VARCHAR2(100), 
	"RAW_PRODUCT_CATEGORY" VARCHAR2(100), 
	"RAW_UNITS_SOLD" VARCHAR2(100), 
	"RAW_GROSS_SALES" VARCHAR2(100), 
	"WEEK_START" DATE, 
	"STORE_CODE" VARCHAR2(30), 
	"PRODUCT_CATEGORY" VARCHAR2(50), 
	"UNITS_SOLD" NUMBER(12,0), 
	"GROSS_SALES" NUMBER(14,2), 
	"VALIDATION_STATUS" VARCHAR2(20) DEFAULT 'PENDING' NOT NULL ENABLE, 
	"ERROR_CODE" VARCHAR2(100), 
	"ERROR_MESSAGE" VARCHAR2(4000), 
	"IS_DUPLICATE_IN_FILE" CHAR(1) DEFAULT 'N' NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6), 
	 CONSTRAINT "POC_SALES_STG_STATUS_CK" CHECK ( 
        validation_status IN ('PENDING','VALID','INVALID','PROCESSED') 
    ) ENABLE, 
	 CONSTRAINT "POC_SALES_STG_DUP_CK" CHECK (is_duplicate_in_file IN ('Y','N')) ENABLE, 
	 PRIMARY KEY ("STG_ID")
  USING INDEX  ENABLE, 
	 CONSTRAINT "POC_SALES_STG_ROW_UQ" UNIQUE ("BATCH_ID", "EXCEL_ROW_NUM")
  USING INDEX  ENABLE
   ) ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "BIU_POC_PRODUCT_CATEGORIES" 
BEFORE INSERT OR UPDATE ON poc_product_categories 
FOR EACH ROW 
BEGIN 
    :NEW.category_code := UPPER(TRIM(:NEW.category_code)); 
    :NEW.category_name := TRIM(:NEW.category_name); 
    :NEW.active_yn     := UPPER(TRIM(:NEW.active_yn)); 
    :NEW.updated_at    := SYSTIMESTAMP; 
END;
/
ALTER TRIGGER "BIU_POC_PRODUCT_CATEGORIES" ENABLE;

  CREATE OR REPLACE EDITIONABLE TRIGGER "BIU_POC_STORES" 
BEFORE INSERT OR UPDATE ON poc_stores 
FOR EACH ROW 
BEGIN 
    :NEW.store_code := UPPER(TRIM(:NEW.store_code)); 
    :NEW.store_name := TRIM(:NEW.store_name); 
    :NEW.active_yn  := UPPER(TRIM(:NEW.active_yn)); 
    :NEW.updated_at := SYSTIMESTAMP; 
END;
/
ALTER TRIGGER "BIU_POC_STORES" ENABLE;

  ALTER TABLE "POC_WEEKLY_SALES" ADD CONSTRAINT "POC_SALES_STORE_FK" FOREIGN KEY ("STORE_CODE")
	  REFERENCES "POC_STORES" ("STORE_CODE") ENABLE;
  ALTER TABLE "POC_WEEKLY_SALES" ADD CONSTRAINT "POC_SALES_CAT_FK" FOREIGN KEY ("PRODUCT_CATEGORY")
	  REFERENCES "POC_PRODUCT_CATEGORIES" ("CATEGORY_CODE") ENABLE;
  ALTER TABLE "POC_WEEKLY_SALES" ADD CONSTRAINT "POC_SALES_BATCH_FK" FOREIGN KEY ("SOURCE_BATCH_ID")
	  REFERENCES "POC_WEEKLY_SALES_BATCH" ("BATCH_ID") ENABLE;

  CREATE INDEX "POC_SALES_I1" ON "POC_WEEKLY_SALES" ("WEEK_START") 
  ;

  CREATE INDEX "POC_SALES_I3" ON "POC_WEEKLY_SALES" ("SOURCE_BATCH_ID") 
  ;

  CREATE INDEX "POC_SALES_I2" ON "POC_WEEKLY_SALES" ("STORE_CODE", "WEEK_START") 
  ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "BIU_POC_WEEKLY_SALES" 
BEFORE INSERT OR UPDATE ON poc_weekly_sales 
FOR EACH ROW 
BEGIN 
    :NEW.store_code       := UPPER(TRIM(:NEW.store_code)); 
    :NEW.product_category := UPPER(TRIM(:NEW.product_category)); 
    :NEW.updated_at       := SYSTIMESTAMP; 
    :NEW.updated_by       := COALESCE(SYS_CONTEXT('APEX$SESSION','APP_USER'), USER); 
END;
/
ALTER TRIGGER "BIU_POC_WEEKLY_SALES" ENABLE;

  CREATE INDEX "POC_SALES_BATCH_I2" ON "POC_WEEKLY_SALES_BATCH" ("STATUS") 
  ;

  CREATE INDEX "POC_SALES_BATCH_I1" ON "POC_WEEKLY_SALES_BATCH" ("UPLOADED_AT") 
  ;

  ALTER TABLE "POC_WEEKLY_SALES_STG" ADD CONSTRAINT "POC_SALES_STG_BATCH_FK" FOREIGN KEY ("BATCH_ID")
	  REFERENCES "POC_WEEKLY_SALES_BATCH" ("BATCH_ID") ENABLE;

  CREATE INDEX "POC_SALES_STG_I2" ON "POC_WEEKLY_SALES_STG" ("BATCH_ID", "VALIDATION_STATUS") 
  ;

  CREATE INDEX "POC_SALES_STG_I1" ON "POC_WEEKLY_SALES_STG" ("BATCH_ID") 
  ;

  CREATE INDEX "POC_SALES_STG_I3" ON "POC_WEEKLY_SALES_STG" ("STORE_CODE") 
  ;

  CREATE INDEX "POC_SALES_STG_I4" ON "POC_WEEKLY_SALES_STG" ("WEEK_START") 
  ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "BIU_POC_SALES_STG" 
BEFORE INSERT OR UPDATE ON poc_weekly_sales_stg 
FOR EACH ROW 
BEGIN 
    IF :NEW.store_code IS NOT NULL THEN 
        :NEW.store_code := UPPER(TRIM(:NEW.store_code)); 
    END IF; 
 
    IF :NEW.product_category IS NOT NULL THEN 
        :NEW.product_category := UPPER(TRIM(:NEW.product_category)); 
    END IF; 
 
    :NEW.updated_at := SYSTIMESTAMP; 
END;
/
ALTER TRIGGER "BIU_POC_SALES_STG" ENABLE;
